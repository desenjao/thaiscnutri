<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Leads Nutrição</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
     :root {
  --primary: #3A7D6A;      /* Verde oliva moderno */
  --secondary: #9ED9C5;    /* Verde menta suave */
  --danger: #E26D5A;       /* Coral elegante (menos agressivo) */
  --warning: #F2C94C;      /* Amarelo pastel */
  --light: #f9fbfa;        /* Branco quente */
  --dark: #1F2933;         /* Grafite (bem mais moderno que preto) */
  --gray: #6b807b;         /* Cinza neutro atual */
  --border: #E5E7EB;       /* Border clean */
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #f5f7fa;
  color: var(--dark);
  font-size: 15px;
  line-height: 1.4;
  padding-bottom: env(safe-area-inset-bottom);
}

/* Header Fixo com gradiente sutil */
.header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: linear-gradient(180deg, #ffffff 0%, #f9fbfa 100%);
  padding: 15px 16px 10px;
  border-bottom: 1px solid var(--border);
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.app-title {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
}

.app-title h1 {
  font-size: 22px;
  font-weight: 600;
  color: var(--primary);
}

.icon-logo {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, var(--primary), #4A8BDD);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
}

/* Barra de Busca */
.search-container {
  position: relative;
  margin-bottom: 15px;
}

.search-input {
  width: 100%;
  padding: 14px 45px 14px 45px;
  border: 1px solid var(--border);
  border-radius: 12px;
  font-size: 16px;
  background: var(--light);
  outline: none;
}

.search-input:focus {
  border-color: var(--primary);
  background: white;
}

.search-icon {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--gray);
}

.clear-search {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--gray);
  font-size: 18px;
  cursor: pointer;
  display: none;
}

/* Chips de Filtro */
.filters-chips {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  padding: 5px 0 10px;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}

.filters-chips::-webkit-scrollbar {
  display: none;
}

.chip {
  padding: 8px 14px;
  background: white;
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 14px;
  white-space: nowrap;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 6px;
}

.chip:hover, .chip.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.chip i {
  font-size: 12px;
}

/* Contador */
.counter {
  padding: 0 16px 10px;
  font-size: 14px;
  color: var(--gray);
  display: flex;
  justify-content: space-between;
}

/* Lista de Cards com identidade visual */
.leads-list {
  padding: 0 16px 20px;
}

.lead-card {
  background: white;
  border-radius: 14px;
  padding: 18px;
  margin-bottom: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  border-left: 4px solid var(--primary);
  border-right: 1px solid transparent;
  border-top: 1px solid transparent;
  border-bottom: 1px solid transparent;
  transition: all 0.2s;
  cursor: pointer;
}

.lead-card:hover {
  border-color: var(--primary);
  box-shadow: 0 4px 12px rgba(42, 110, 187, 0.1);
  transform: translateY(-2px);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
}

.lead-name {
  font-size: 18px;
  font-weight: 600;
  color: var(--dark);
  margin-bottom: 4px;
}

.lead-meta {
  font-size: 13px;
  color: var(--gray);
  display: flex;
  align-items: center;
  gap: 12px;
}

/* Status reforçado */
.lead-status {
  padding: 5px 12px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
}

.status-ready {
  background: rgba(58,125,106,0.15);
  color: var(--primary);
}

.status-partial {
  background: rgba(242,201,76,0.2);
  color: #B08900;
}

.card-body {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 15px;
}

.card-item {
  display: flex;
  flex-direction: column;
}

.card-label {
  font-size: 12px;
  color: var(--gray);
  margin-bottom: 4px;
}

.card-value {
  font-weight: 500;
  color: var(--dark);
}

/* IMC com mais destaque */
.imc-indicator {
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.imc-indicator span {
  font-weight: 600;
}

.imc-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.imc-normal { 
  background: var(--secondary); 
  color: var(--primary);
}
.imc-over { 
  background: var(--warning); 
  color: #B08900;
}
.imc-obese { 
  background: var(--danger); 
  color: var(--danger);
}

/* Objetivo como "caixa de intenção" */
.lead-objective {
  font-size: 14px;
  line-height: 1.5;
  margin-top: 10px;
  padding: 10px 12px;
  background: var(--light);
  border-radius: 10px;
  border-left: 3px solid var(--secondary);
  color: var(--dark);
}

.lead-objective strong {
  color: var(--primary);
}

/* Modal Detalhes */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  display: flex;
  align-items: flex-end;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal {
  background: white;
  border-radius: 24px 24px 0 0;
  width: 100%;
  max-height: 85vh;
  overflow-y: auto;
  transform: translateY(100%);
  transition: transform 0.3s;
}

.modal-overlay.active .modal {
  transform: translateY(0);
}

.modal-header {
  padding: 20px 20px 15px;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  background: white;
  border-radius: 24px 24px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-title {
  font-size: 20px;
  font-weight: 600;
  color: var(--dark);
}

.modal-close {
  background: var(--light);
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: var(--gray);
}

.modal-body {
  padding: 20px;
}

.detail-section {
  margin-bottom: 25px;
}

.section-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--primary);
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title i {
  width: 24px;
}

.detail-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}

.detail-item {
  margin-bottom: 12px;
}

.detail-label {
  font-size: 13px;
  color: var(--gray);
  margin-bottom: 5px;
}

.detail-value {
  font-size: 15px;
  color: var(--dark);
  font-weight: 500;
}

.full-width {
  grid-column: 1 / -1;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
}

.empty-icon {
  font-size: 48px;
  color: #D1D5DB;
  margin-bottom: 20px;
}

.empty-title {
  font-size: 18px;
  color: var(--dark);
  margin-bottom: 10px;
}

.empty-text {
  color: var(--gray);
  font-size: 14px;
}

/* Responsivo */
@media (min-width: 768px) {
  body {
    max-width: 500px;
    margin: 0 auto;
    border-left: 1px solid var(--border);
    border-right: 1px solid var(--border);
  }
  
  .modal {
    max-width: 500px;
    margin: 0 auto;
    border-radius: 20px;
    max-height: 90vh;
  }
  
  .modal-overlay {
    align-items: center;
  }
}
    </style>
</head>
<body>
    <!-- Header com Busca -->
    <div class="header">
        <div class="app-title">
            <div class="icon-logo">
                <i class="fas fa-user-md"></i>
            </div>
            <h1>Leads Nutrição</h1>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" id="searchInput" placeholder="Buscar paciente...">
            <button class="clear-search" id="clearSearch">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Chips de Filtro Rápido -->
        <div class="filters-chips" id="filterChips">
            <div class="chip active" data-filter="all">
                <i class="fas fa-users"></i>Todos
            </div>
            <div class="chip" data-filter="prontidao:alta">
                <i class="fas fa-bolt"></i>Alta Prontidão
            </div>
            <div class="chip" data-filter="imc:sobrepeso">
                <i class="fas fa-weight"></i>Sobrepeso
            </div>
            <div class="chip" data-filter="objetivo:ansiedade">
                <i class="fas fa-brain"></i>Ansiedade
            </div>
            <div class="chip" data-filter="atividade:regular">
                <i class="fas fa-running"></i>Ativos
            </div>
            <div class="chip" data-filter="idade:30-40">
                <i class="fas fa-birthday-cake"></i>30-40 anos
            </div>
        </div>
    </div>
    
    <!-- Contador -->
    <div class="counter">
        <span id="totalCount">0 pacientes</span>
        <span id="filteredCount">0 visíveis</span>
    </div>
    
    <!-- Lista de Leads -->
    <div class="leads-list" id="leadsList">
        <!-- Cards serão inseridos aqui -->
        <div class="empty-state" id="emptyState">
            <div class="empty-icon">
                <i class="fas fa-user-injured"></i>
            </div>
            <div class="empty-title">Carregando pacientes...</div>
            <div class="empty-text">Aguarde um momento</div>
        </div>
    </div>
    
    <!-- Modal de Detalhes -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle"></div>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Conteúdo será preenchido -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos principais
            const leadsList = document.getElementById('leadsList');
            const emptyState = document.getElementById('emptyState');
            const searchInput = document.getElementById('searchInput');
            const clearSearch = document.getElementById('clearSearch');
            const filterChips = document.getElementById('filterChips');
            const totalCount = document.getElementById('totalCount');
            const filteredCount = document.getElementById('filteredCount');
            const modalOverlay = document.getElementById('modalOverlay');
            const modalClose = document.getElementById('modalClose');
            
            let pacientes = [];
            let filteredPacientes = [];
            let activeFilters = [];
            
            // Carregar dados
            async function carregarDados() {
                try {
                    const response = await fetch('data/dashleads.json');
                    const data = await response.json();
                    
                    if (data?.dashboard_summary?.pacientes) {
                        pacientes = data.dashboard_summary.pacientes;
                        totalCount.textContent = `${pacientes.length} pacientes`;
                        aplicarFiltros();
                    }
                } catch (error) {
                    console.error('Erro ao carregar:', error);
                    emptyState.innerHTML = `
                        <div class="empty-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="empty-title">Erro ao carregar</div>
                        <div class="empty-text">Verifique o arquivo de dados</div>
                    `;
                }
            }
            
            // Classificar IMC
            function classificarIMC(imc) {
                if (imc < 25) return {classe: 'Normal', cor: 'imc-normal'};
                if (imc < 30) return {classe: 'Sobrepeso', cor: 'imc-over'};
                return {classe: 'Obesidade', cor: 'imc-obese'};
            }
            
            // Renderizar cards
            function renderizarCards() {
                if (filteredPacientes.length === 0) {
                    emptyState.style.display = 'block';
                    emptyState.innerHTML = `
                        <div class="empty-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="empty-title">Nenhum paciente encontrado</div>
                        <div class="empty-text">Tente outros filtros ou busca</div>
                    `;
                    leadsList.innerHTML = '';
                    leadsList.appendChild(emptyState);
                    return;
                }
                
                emptyState.style.display = 'none';
                
                let cardsHTML = '';
                
                filteredPacientes.forEach(paciente => {
                    const imc = classificarIMC(paciente.biometria.imc);
                    const prontidao = paciente.perfil_comportamental.prontidao;
                    const objetivo = paciente.perfil_comportamental.principal_objetivo.split(',')[0];
                    
                    cardsHTML += `
                    <div class="lead-card" data-id="${paciente.id}">
                        <div class="card-header">
                            <div>
                                <div class="lead-name">${paciente.nome}</div>
                                <div class="lead-meta">
                                    <span>${paciente.idade > 0 ? paciente.idade + ' anos' : 'Idade N/A'}</span>
                                    <span>${paciente.biometria.peso_kg}kg / ${paciente.biometria.altura_cm}cm</span>
                                </div>
                            </div>
                            <div class="lead-status ${prontidao === 'alta' ? 'status-ready' : 'status-partial'}">
                                ${prontidao === 'alta' ? 'Alta' : 'Média'}
                            </div>
                        </div>
                        
                        <div class="card-body">
                            <div class="card-item">
                                <div class="card-label">IMC</div>
                                <div class="card-value">
                                    <span class="imc-indicator">
                                        <span class="imc-dot ${imc.cor}"></span>
                                        ${paciente.biometria.imc.toFixed(1)} (${imc.classe})
                                    </span>
                                </div>
                            </div>
                            <div class="card-item">
                                <div class="card-label">Atividade</div>
                                <div class="card-value">
                                    ${paciente.perfil_comportamental.atividade_fisica === 'Sim, regularmente' ? 'Ativo' : 'Irregular'}
                                </div>
                            </div>
                        </div>
                        
                        <div class="lead-objective">
                            <strong>Objetivo:</strong> ${objetivo}
                        </div>
                    </div>
                    `;
                });
                
                leadsList.innerHTML = cardsHTML;
                
                // Adicionar eventos aos cards
                document.querySelectorAll('.lead-card').forEach(card => {
                    card.addEventListener('click', function() {
                        const id = parseInt(this.dataset.id);
                        abrirDetalhes(id);
                    });
                });
            }
            
            // Aplicar filtros
            function aplicarFiltros() {
                const busca = searchInput.value.toLowerCase();
                
                filteredPacientes = pacientes.filter(paciente => {
                    // Busca por texto
                    if (busca) {
                        const texto = [
                            paciente.nome,
                            paciente.contato.email,
                            paciente.perfil_comportamental.principal_objetivo,
                            paciente.perfil_comportamental.principal_barreira
                        ].join(' ').toLowerCase();
                        
                        if (!texto.includes(busca)) return false;
                    }
                    
                    // Filtros por chips
                    if (activeFilters.length > 0) {
                        let passa = true;
                        
                        activeFilters.forEach(filtro => {
                            if (filtro === 'prontidao:alta') {
                                if (paciente.perfil_comportamental.prontidao !== 'alta') passa = false;
                            }
                            else if (filtro === 'imc:sobrepeso') {
                                const imc = paciente.biometria.imc;
                                if (imc < 25 || imc >= 30) passa = false;
                            }
                            else if (filtro === 'objetivo:ansiedade') {
                                const obj = paciente.perfil_comportamental.principal_objetivo.toLowerCase();
                                if (!obj.includes('ansiedade')) passa = false;
                            }
                            else if (filtro === 'atividade:regular') {
                                if (paciente.perfil_comportamental.atividade_fisica !== 'Sim, regularmente') passa = false;
                            }
                            else if (filtro === 'idade:30-40') {
                                if (paciente.idade < 30 || paciente.idade > 40) passa = false;
                            }
                        });
                        
                        if (!passa) return false;
                    }
                    
                    return true;
                });
                
                filteredCount.textContent = `${filteredPacientes.length} visíveis`;
                renderizarCards();
            }
            
            // Abrir detalhes do paciente
            function abrirDetalhes(id) {
                const paciente = pacientes.find(p => p.id === id);
                if (!paciente) return;
                
                const imc = classificarIMC(paciente.biometria.imc);
                
                document.getElementById('modalTitle').textContent = paciente.nome;
                
                document.getElementById('modalBody').innerHTML = `
                    <div class="detail-section">
                        <div class="section-title">
                            <i class="fas fa-id-card"></i>
                            Informações
                        </div>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">Idade</div>
                                <div class="detail-value">${paciente.idade > 0 ? paciente.idade + ' anos' : 'N/A'}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Contato</div>
                                <div class="detail-value">${paciente.contato.telefone}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">IMC</div>
                                <div class="detail-value">
                                    <span class="imc-indicator">
                                        <span class="imc-dot ${imc.cor}"></span>
                                        ${paciente.biometria.imc.toFixed(1)} (${imc.classe})
                                    </span>
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Prontidão</div>
                                <div class="detail-value">
                                    <span class="lead-status ${paciente.perfil_comportamental.prontidao === 'alta' ? 'status-ready' : 'status-partial'}">
                                        ${paciente.perfil_comportamental.prontidao === 'alta' ? 'Alta' : 'Média'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-title">
                            <i class="fas fa-bullseye"></i>
                            Objetivos
                        </div>
                        <div class="detail-item full-width">
                            <div class="detail-value">${paciente.perfil_comportamental.principal_objetivo}</div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Barreiras
                        </div>
                        <div class="detail-item full-width">
                            <div class="detail-value">${paciente.perfil_comportamental.principal_barreira}</div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-title">
                            <i class="fas fa-heartbeat"></i>
                            Hábitos
                        </div>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">Atividade Física</div>
                                <div class="detail-value">${paciente.perfil_comportamental.atividade_fisica}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Sono</div>
                                <div class="detail-value">${paciente.perfil_comportamental.sono}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Autoimagem</div>
                                <div class="detail-value">${paciente.perfil_comportamental.autoimagem}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-title">
                            <i class="fas fa-comments"></i>
                            Contato
                        </div>
                        <div class="detail-item full-width">
                            <div class="detail-value">${paciente.contato.email}</div>
                        </div>
                    </div>
                `;
                
                modalOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            // Event Listeners
            
            // Chips de filtro
            filterChips.addEventListener('click', function(e) {
                const chip = e.target.closest('.chip');
                if (!chip) return;
                
                const filtro = chip.dataset.filter;
                
                if (filtro === 'all') {
                    // Desmarcar todos os outros chips
                    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                    activeFilters = [];
                } else {
                    // Alternar chip individual
                    chip.classList.toggle('active');
                    
                    if (chip.classList.contains('active')) {
                        activeFilters.push(filtro);
                    } else {
                        activeFilters = activeFilters.filter(f => f !== filtro);
                    }
                    
                    // Desmarcar "Todos" se outro filtro ativo
                    if (activeFilters.length > 0) {
                        document.querySelector('[data-filter="all"]').classList.remove('active');
                    } else {
                        document.querySelector('[data-filter="all"]').classList.add('active');
                    }
                }
                
                aplicarFiltros();
            });
            
            // Busca
            searchInput.addEventListener('input', function() {
                clearSearch.style.display = this.value ? 'block' : 'none';
                aplicarFiltros();
            });
            
            clearSearch.addEventListener('click', function() {
                searchInput.value = '';
                this.style.display = 'none';
                aplicarFiltros();
                searchInput.focus();
            });
            
            // Modal
            modalClose.addEventListener('click', function() {
                modalOverlay.classList.remove('active');
                document.body.style.overflow = 'auto';
            });
            
            modalOverlay.addEventListener('click', function(e) {
                if (e.target === modalOverlay) {
                    modalOverlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });
            
            // Fechar modal com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modalOverlay.classList.contains('active')) {
                    modalOverlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });
            
            // Inicializar
            carregarDados();
            
            // Swipe para fechar modal (mobile)
            let startY = 0;
            modalOverlay.addEventListener('touchstart', function(e) {
                startY = e.touches[0].clientY;
            });
            
            modalOverlay.addEventListener('touchmove', function(e) {
                const currentY = e.touches[0].clientY;
                const diff = currentY - startY;
                
                if (diff > 50) { // Swipe para baixo
                    modalOverlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });
        });
    </script>
</body>
</html>